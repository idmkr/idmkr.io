<?php/* * Helpers */function isCloudflareFlexibleHttps() {    return empty($_SERVER['HTTP_X_FORWARDED_PROTO']) ?            !empty($_SERVER['HTTPS']) :            $_SERVER['HTTP_X_FORWARDED_PROTO'] == "https";}/*****/* Host and protocol redirects * */$currentHost = $app->request->getHost();// Force host redirectsif($isMobile && $currentHost != "m.idmkr.io")    $newHost = "m.idmkr.io";else if(!$isMobile && $currentHost != "idmkr.io")    $newHost = "idmkr.io";// Force HTTPS redirectelse if(!isCloudflareFlexibleHttps())    $newHost = $currentHost;if(isset($newHost)) {    header("Location: https://".$newHost.$app->request->getResourceUri());    exit;}/* * Routes * *//** @var League\Plates\Engine $plates */$plates = $app->view()->getInstance();// Landing pages$app->get('/(:page)', function ($page = "index") use ($app,$plates) {    if(!$page || !$plates->exists($page))        $page = 'index';    $plates->addData([        'isHomepage' => true,        'page' => $page    ]);    $app->render($page);})->name('home');// Ajax callsif($app->request->isXhr()) :    $app->post('/envoi-formulaire/:type', function ($type) use($app) {        $formClass = 'Forms\\'.ucfirst($type).'Form';        /** @var \Forms\Form $form */        $form = new $formClass;        if(!$form->validate($_POST))            echo json_encode($form->getErrors());    });    $app->get('/page/:page', function ($page) use ($app,$plates) {        $plates->addData([            'isHomepage'=>false,            "page"=>$page        ]);        $app->render("$page/fullpage");    });endif; 